# Die Hard


Tech stack:
- Python 3.13
- Django 5
- pytest
- Docker & docker-compose
- PostgreSQL
- ClickHouse
- Celery & Celery Beat
- structlog (для структурированного логирования)

## Изменения

### Транзакционный Outbox

Реализован шаблон транзакционного outbox, чтобы решить проблемы с прямой записью в ClickHouse, обеспечив большую надежность и исключив потерю событий в случае сбоев.

### Пакетирование вставок
Внедрено пакетирование вставок в ClickHouse для уменьшения нагрузки на систему путем минимизации количества операций вставки. Это помогает оптимизировать производительность и избежать избыточных вставок строк.

### Структурированное логирование
Интегрировано структурированное логирование с использованием structlog для лучшей трассируемости событий и ошибок по всей системе. Это позволяет поддерживать четкие и последовательные сообщения в логах приложения.

### Разделение задач Celery
Разделена логика обработки логов и задачи Celery, что повысило повторное использование и поддерживаемость кода. Это позволяет создать более чистую архитектуру, где бизнес-логика и задачи логирования изолированы друг от друга.

### Обработка ошибок и мониторинг
Интегрирована обработка ошибок и логирование с помощью structlog, а также добавлена поддержка мониторинга через Sentry (или аналогичные инструменты) для захвата и трассировки исключений и событий в системе.

### Тестирование
Добавлены unit-тесты для новой функциональности с реальными интеграционными тестами с экземпляром ClickHouse, работающим в Docker. Моки использовались только в случаях крайней необходимости для обеспечения более реалистичного и точного тестирования.

### CI/CD
Настроена CI/CD пайплайн с использованием GitHub Actions для автоматизации тестирования и деплоя.

## Installation

Put a `.env` file into the `src/core` directory. You can start with a template file:

```
cp src/core/.env.ci src/core/.env
```

Run the containers with
```
make run
```

and then run the installation script with:

```
make install
```

## Tests

`make test`

## Linter

`make lint`
